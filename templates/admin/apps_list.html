{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/applications_list.css' %}">
{% endblock %}

{% block content %}
<div class="page-container">

<h1>All Applications</h1>

<!-- FILTER BAR -->
<div class="apps-filter-bar">   
    <form method="GET" class="apps-filter-form">

        <!-- Search -->
        <input type="text"
               name="search"
               placeholder="Search candidate name or email..."
               value="{{ search }}"
               class="apps-input">

        <button type="submit" class="btn btn-primary apps-btn">
            Search
        </button>

        <!-- Status Filter -->
        <select name="status" class="apps-select" onchange="this.form.submit()">
            <option value="">All Status</option>
            <option value="screening" {% if status_filter == "screening" %}selected{% endif %}>
                Screening ({{ counts.screening }})
            </option>
            <option value="review" {% if status_filter == "review" %}selected{% endif %}>
                Review ({{ counts.review }})
            </option>
            <option value="interview" {% if status_filter == "interview" %}selected{% endif %}>
                Interview ({{ counts.interview }})
            </option>
            <option value="hired" {% if status_filter == "hired" %}selected{% endif %}>
                Hired ({{ counts.hired }})
            </option>
            <option value="rejected" {% if status_filter == "rejected" %}selected{% endif %}>
                Rejected ({{ counts.rejected }})
            </option>
        </select>

    </form>
</div>

<!-- TABLE -->
<table class="table mt-3">
    <thead>
        <tr>
            <th>Candidate</th>
            <th>Email</th>
            <th>Job</th>
            <th>Status</th>
            <th>Applied On</th>
        </tr>
    </thead>

    <tbody>
    {% for app in apps_page %}
    <tr>

        <td data-label="Candidate">
            <a href="{% url 'admin_application_detail' app.id %}" class="table-link">
                {{ app.full_name }}
            </a>
        </td>

        <td data-label="Email">
            {{ app.email }}
        </td>

        <td data-label="Job">
            <a href="{% url 'admin_job_detail' app.job.id %}" class="table-link">
                {{ app.job.title }}
            </a>
        </td>

        <td data-label="Status">
            {{ app.status|title }}
        </td>

        <td data-label="Applied On">
            {{ app.applied_at|date:"d M Y, h:i A" }}
        </td>

    </tr>
    {% empty %}
    <tr>
        <td colspan="5" class="table-empty">
            No applications found.
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- PAGINATION -->
<div class="pagination-controls mt-3">
    {% if apps_page.has_previous %}
        <a href="?page={{ apps_page.previous_page_number }}&search={{ search }}&status={{ status_filter }}"
           class="btn btn-outline">
            Previous
        </a>
    {% endif %}

    <span class="page-info">
        Page {{ apps_page.number }} of {{ apps_page.paginator.num_pages }}
    </span>

    {% if apps_page.has_next %}
        <a href="?page={{ apps_page.next_page_number }}&search={{ search }}&status={{ status_filter }}"
           class="btn btn-outline">
            Next
        </a>
    {% endif %}
</div>

</div>
{% endblock %}
