{% extends "base.html" %}
{% load static %}
{% block hide_sidebar %}true{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/hrcrudjobs.css' %}">
{% endblock %}

{% block content %}

<div class="page-container">

    <!-- HEADER -->
    <div class="jobs-header">
        <h1>My Jobs</h1>

        <a href="{% url 'hr_job_create' %}" class="btn btn-primary">
            Create New Job
        </a>
    </div>

    <!-- FILTER BAR -->
    <div class="apps-filter-bar">
        <form method="GET" class="apps-filter-form">

            <input type="text"
                   name="search"
                   placeholder="Search job titles..."
                   value="{{ request.GET.search }}"
                   class="apps-input">

            <input type="text"
                   name="location"
                   placeholder="Location"
                   value="{{ request.GET.location }}"
                   class="apps-input apps-input-sm">

            <select name="work_mode" class="apps-select">
                <option value="">All Work Modes</option>
                <option value="onsite" {% if request.GET.work_mode == "onsite" %}selected{% endif %}>On-site</option>
                <option value="remote" {% if request.GET.work_mode == "remote" %}selected{% endif %}>Remote</option>
                <option value="hybrid" {% if request.GET.work_mode == "hybrid" %}selected{% endif %}>Hybrid</option>
            </select>

            <button type="submit" class="btn btn-primary apps-btn">
                Search
            </button>

            <a href="{% url 'hr_job_list' %}" class="apps-clear-btn">
                Clear
            </a>

        </form>
    </div>

    <!-- JOB TABLE -->
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Title</th>
                <th>Location</th>
                <th>Experience</th>
                <th>Work Mode</th>
                <th>Applications</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for job in jobs %}
            <tr>

                <td data-label="Title">
                    <a href="{% url 'hr_job_detail' job.id %}" class="table-link">
                        {{ job.title }}
                    </a>
                </td>

                <td data-label="Location">
                    {{ job.location }}
                </td>

                <td data-label="Experience">
                    {{ job.min_experience }} â€“ {{ job.max_experience }} yrs
                </td>

                <td data-label="Work Mode">
                    {{ job.get_work_mode_display }}
                </td>

                <td data-label="Applications">
                    <a href="{% url 'hr_job_applications' job.id %}" class="btn btn-outline">
                        {{ job.applications_count }}
                    </a>
                </td>

                <td data-label="Actions">
                    <div class="action-buttons">
                        <a href="{% url 'hr_job_edit' job.id %}" class="btn-action btn-edit">
                            Edit
                        </a>

                        <form action="{% url 'hr_job_delete' job.id %}" method="post">
                            {% csrf_token %}
                            <button class="btn-action btn-delete"
                                    onclick="return confirm('Are you sure?');">
                                Delete
                            </button>
                        </form>
                    </div>
                </td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="table-empty">
                    No jobs found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- PAGINATION -->
    {% if is_paginated %}
    <div class="pagination-controls mt-3">

        {% if page_obj.has_previous %}
        <a class="btn btn-outline"
           href="?page={{ page_obj.previous_page_number }}&search={{ request.GET.search }}&location={{ request.GET.location }}&work_mode={{ request.GET.work_mode }}">
            Previous
        </a>
        {% endif %}

        <span class="page-info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a class="btn btn-outline"
           href="?page={{ page_obj.next_page_number }}&search={{ request.GET.search }}&location={{ request.GET.location }}&work_mode={{ request.GET.work_mode }}">
            Next
        </a>
        {% endif %}

    </div>
    {% endif %}

</div>

{% endblock %}
