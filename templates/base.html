{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}HireFlow{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/pages/sidebar.css' %}">
    {% block extra_css %}{% endblock %}
</head>

<!-- ✅ ONLY CHANGE IS HERE -->
<body class="
    {% if user.is_authenticated %}
        {% if user.role == 'ADMIN' or user.role == 'SUPERUSER' %}
            role-admin
        {% elif user.role == 'HR' %}
            role-hr
        {% endif %}
    {% endif %}
">   

{% if user.is_authenticated and not hide_sidebar %}
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay"></div>
    {% include "content/sidebar.html" %}
{% endif %}
<div class="page-content {% if hide_sidebar %}no-sidebar{% endif %}">

    {% if messages %}
    <div class="alert-container">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                <div class="alert-content">
                    <span class="alert-icon">✓</span>
                    <span class="alert-text">{{ message }}</span>
                </div>
                <button class="alert-close">&times;</button>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% block content %}{% endblock %}

</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.getElementById("sidebar");
    const toggle = document.getElementById("toggleSidebar");
    const overlay = document.querySelector(".sidebar-overlay");
    const content = document.querySelector(".page-content");

    if (!sidebar || !toggle) return;

    const isDesktop = () => window.innerWidth >= 769;

    function openSidebar() {
        sidebar.classList.add("open");
        if (isDesktop()) {
            content.classList.add("shift");
        } else {
            overlay.classList.add("active");
            document.body.classList.add("no-scroll");
        }
    }

    function closeSidebar() {
        sidebar.classList.remove("open");
        content.classList.remove("shift");
        overlay.classList.remove("active");
        document.body.classList.remove("no-scroll");
    }

    toggle.addEventListener("click", () => {
        sidebar.classList.contains("open") ? closeSidebar() : openSidebar();
    });
if (overlay) {
    overlay.addEventListener("click", closeSidebar);
}

    window.addEventListener("resize", () => {
        if (isDesktop()) {
            overlay.classList.remove("active");
            document.body.classList.remove("no-scroll");
        } else {
            content.classList.remove("shift");
        }
    });

    setTimeout(() => {
        document.body.classList.add("sidebar-ready");
    }, 10);
});
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".alert-close").forEach(function (btn) {
        btn.addEventListener("click", function () {
            const box = btn.closest(".alert");
            box.classList.add("hide");
            box.addEventListener("transitionend", function () {
                box.remove();
            });
        });
    });
});

function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);

    if (!input) return;

    if (input.type === "password") {
        input.type = "text";
        if (icon) icon.classList.add("active");
    } else {
        input.type = "password";
        if (icon) icon.classList.remove("active");
    }
}
setTimeout(() => {
    document.querySelectorAll(".alert").forEach(alert => {
        alert.classList.add("hide");
        setTimeout(() => alert.remove(), 300);
    });
}, 4000);

document.addEventListener("DOMContentLoaded", function () {

    const logoutBtn = document.getElementById("logoutConfirmBtn");
    const popup = document.getElementById("logoutPopup");
    const yesBtn = document.getElementById("logoutYes");
    const noBtn = document.getElementById("logoutNo");

    if (logoutBtn) {
        logoutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            popup.style.display = "flex";
        });
    }

    if (noBtn) {
        noBtn.addEventListener("click", function () {
            popup.style.display = "none";
        });
    }

    if (yesBtn) {
        yesBtn.addEventListener("click", function () {
            window.location.href = "/logout/";
        });
    }

});
</script>

</body>
</html>

